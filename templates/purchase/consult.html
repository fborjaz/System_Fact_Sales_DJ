{% extends 'components/base.html' %}
{% load static %}

{% block content %}
<title>{% block title %}Detalles de Compra{% endblock title %}</title>
<section class="bg-gray-100 dark:bg-gray-900 py-10 mt-20">
    <div class="container mx-auto px-4" data-aos="fade-up" data-aos-delay="200">
        <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 shadow-lg rounded-lg overflow-hidden">
            <!-- Purchase Header -->
            <div class="bg-blue-600 dark:bg-blue-800 text-white px-8 py-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold">Detalles de Compra</h1>
                        <p class="text-sm mt-1 opacity-80">Nº {{ purchase.id }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm opacity-80">Fecha de emisión</p>
                        <p class="text-lg font-semibold">{{ purchase.issue_date|date:"d/m/Y" }}</p>
                    </div>
                </div>
            </div>

            <!-- Purchase Body -->
            <div class="px-8 py-6">
                <!-- Supplier Details -->
                <div class="flex justify-between mb-8">
                    <div>
                        <h2 class="text-xl font-semibold mb-2 dark:text-white">Proveedor:</h2>
                        <p class="text-gray-700 dark:text-gray-300">{{ purchase.supplier.name }}</p>
                        <p class="text-gray-700 dark:text-gray-300">{{ purchase.supplier.email }}</p>
                    </div>
                </div>

                <!-- Purchase Details Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="bg-gray-200 dark:bg-gray-700">
                                <th class="px-4 py-2 text-gray-600 dark:text-gray-300">Producto</th>
                                <th class="px-4 py-2 text-gray-600 dark:text-gray-300">Cantidad</th>
                                <th class="px-4 py-2 text-gray-600 dark:text-gray-300">Precio Unitario</th>
                                <th class="px-4 py-2 text-gray-600 dark:text-gray-300">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for detail in purchase.details %}
                                <tr class="border-b dark:border-gray-700">
                                    <td class="px-4 py-2 dark:text-gray-300">{{ detail.product.description }}</td>
                                    <td class="px-4 py-2 dark:text-gray-300">{{ detail.quantify }}</td>
                                    <td class="px-4 py-2 dark:text-gray-300">${{ detail.cost }}</td>
                                    <td class="px-4 py-2 dark:text-gray-300">${{ detail.subtotal }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="4" class="px-4 py-2 text-center dark:text-gray-300">No hay productos en esta compra.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Purchase Summary -->
                <div class="mt-8 flex justify-end">
                    <div class="w-64">
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold text-gray-600 dark:text-gray-300">Subtotal:</span>
                            <span class="text-gray-700 dark:text-gray-300">${{ purchase.subtotal }}</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="font-semibold text-gray-600 dark:text-gray-300">IVA:</span>
                            <span class="text-gray-700 dark:text-gray-300">${{ purchase.iva }}</span>
                        </div>
                        <div class="flex justify-between border-t pt-2 mt-2">
                            <span class="font-bold text-gray-700 dark:text-white">Total:</span>
                            <span class="font-bold text-gray-700 dark:text-white">${{ purchase.total }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Purchase Footer -->
            <div class="bg-gray-100 dark:bg-gray-700 px-8 py-6 text-center text-gray-500 dark:text-gray-300 text-sm">
                <p>Detalles de la compra. Para cualquier consulta, por favor contáctenos.</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mt-8 flex justify-center space-x-4">
            <a class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg inline-flex items-center transition duration-300 ease-in-out"
               href="{% url 'purcharse:purchase_list' %}">
                <i class="fas fa-arrow-left mr-2"></i> Volver a la lista de compras
            </a>
            <a class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg inline-flex items-center transition duration-300 ease-in-out"
               href="{% url 'purcharse:generate_purchase_pdf' purchase.id %}">
                <i class="fas fa-file-pdf mr-2"></i> Generar PDF
            </a>
        </div>
    </div>
</section>
{% endblock %}
